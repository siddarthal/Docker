FROM golang:1.16-alpine
RUN apk update && apk add --no-cache gcc musl-dev
WORKDIR /usr/src/app
COPY /example-backend .
ENV REQUEST_ORIGIN=http://3.142.244.189:5000
ENV REDIS_HOST=redis
ENV POSTGRES_HOST=postgres
ENV POSTGRES_USER=postgres
ENV POSTGRES_PASSWORD=postgres
ENV POSTGRES_DATABASE=postgres
RUN go build
RUN go test ./...
EXPOSE 8080
ENTRYPOINT ["./server"]